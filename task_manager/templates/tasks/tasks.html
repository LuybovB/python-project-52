{% extends 'base.html' %}
{% load i18n %}
{% block content %}
  <h2>{% trans 'Tasks' %}</h2>
  <a href="{% url 'task_create' %}" class="btn btn-success mb-3">{% trans 'Create task' %}</a>

  <form method="get" class="form-inline">
    <!-- Фильтр Статус -->
    <div class="form-group mb-2">
      <label class="form-label" for="id_status">{% trans 'Status' %}</label>
      <select name="status" class="form-select ml-2 mr-3 is-valid" id="id_status">
        <option value="" {% if not request.GET.status %}selected{% endif %} disabled>---------</option>
        {% for status in statuses %}
          <option value="{{ status.id }}" {% if request.GET.status == status.id|stringformat:"s" %}selected{% endif %}>
            {{ status.name }}
          </option>
        {% empty %}
          <option value="" disabled>{% trans 'No available statuses' %}</option>
        {% endfor %}
      </select>
    </div>

    <!-- Фильтр Исполнитель -->
    <div class="form-group mb-2">
      <label class="form-label" for="id_executor">{% trans 'Executor' %}</label>
      <select name="executor" class="form-select mr-3 ml-2 is-valid" id="id_executor">
        <option value="" {% if not request.GET.executor %}selected{% endif %} disabled>---------</option>
        {% for executor in executors %}
          <option value="{{ executor.id }}" {% if request.GET.executor == executor.id|stringformat:"s" %}selected{% endif %}>
            {{ executor.get_full_name }}
          </option>
        {% empty %}
          <option value="" disabled>{% trans 'No available executors' %}</option>
        {% endfor %}
      </select>
    </div>

    <!-- Фильтр Метка -->
    <div class="form-group mb-2">
      <label class="form-label" for="id_label">{% trans 'Label' %}</label>
      <select name="label" class="form-select mr-3 ml-2 is-valid" id="id_label">
        <option value="" {% if not request.GET.label %}selected{% endif %} disabled>---------</option>
        {% for label in labels %}
          <option value="{{ label.id }}" {% if request.GET.label == label.id|stringformat:"s" %}selected{% endif %}>
            {{ label.name }}
          </option>
        {% empty %}
          <option value="" disabled>{% trans 'No available labels' %}</option>
        {% endfor %}
      </select>
    </div>

    <!-- Фильтр Только свои задачи -->
    <div class="form-group mb-2">
      <input type="checkbox" name="own_tasks" id="own_tasks" {% if request.GET.own_tasks %}checked{% endif %}>
      <label for="own_tasks">{% trans 'Only my tasks' %}</label>
    </div>

    <!-- Кнопка Показать -->
    <button type="submit" class="btn btn-primary mb-2">{% trans 'Show' %}</button>
  </form>

   <table class="table table-striped mt-4">
    <thead>
      <tr>
        <th scope="col">{% trans 'ID' %}</th>
        <th scope="col">{% trans 'Name' %}</th>
        <th scope="col">{% trans 'Status' %}</th>
        <th scope="col">{% trans 'Author' %}</th>
        <th scope="col">{% trans 'Executor' %}</th>
        <th scope="col">{% trans 'Creation date' %}</th>
      </tr>
    </thead>
    <tbody>
      {% for task in tasks %}
        <tr>
          <th scope="row">{{ task.id }}</th>
          <td><a href="{% url 'task_detail' task.id %}">{{ task.name }}</a></td>
          <td>{{ task.status.name }}</td>
          <td>{{ task.author.get_full_name }}</td>
          <td>{{ task.executor.get_full_name }}</td>
          <td>{{ task.created_at }}</td>
          <td>
              <div><a href="{% url 'task_update' task.id %}">{% trans "Edit" %}</a></div>
              <div><a href="{% url 'task_delete' task.id %}">{% trans "Delete" %}</a></div>
          </td>
        </tr>
      {% endfor %}
    </tbody>
  </table>
{% endblock %}
